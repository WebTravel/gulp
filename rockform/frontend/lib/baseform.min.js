!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.form.min","jquery.mask.min"],t):t("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(t){"use strict";var e="rockform",o="",n={},f={init:function(){t(document).on("focus","[data-bf-mask]",function(){f.set(t(this))}),t("[data-bf-mask]").each(function(){f.set(t(this))})},set:function(t){o=t.data("bf-mask"),n=t.attr("placeholder"),o.length>0&&(("undefined"==typeof n||n.length<1)&&(n=o.replace(/[a-z0-9]+?/gi,"_")),n={placeholder:n},t.mask(o,n))}},i={init:function(e,o){if(o.length>0)i.set({el:e,err_msg:o}),t(window).on("resize",{el:e,err_msg:o},i.set);else{var n=e.attr("name");n&&t('[data-bf-tooltip-id="'+n+'"]').remove()}},set:function(e){var o,n;e.data?(o=e.data.el,n=e.data.err_msg):(o=e.el,n=e.err_msg);var f=o.attr("name");o=t('[name="'+f+'"]:first',o.parents("form"));var a=o.attr("data-bf-tooltip");"undefined"!=typeof a?a=a.replace(/[ ]+?/gi,"-"):(a=o.parents("form").attr("data-bf-tooltip"),a=void 0===a?"right-center":a.replace(/[ ]+?/gi,"-")),t('[data-bf-tooltip-id="'+f+'"]').remove(),o.after('<div class="bf-tooltip bf-tooltip-'+a+'" data-bf-tooltip-id="'+f+'">                          <div class="bf-arrow"></div>'+n+"</div>"),i.position(o)},reset:function(){t(window).off("resize",i.set),t(".bf-tooltip").remove()},response:function(e,o,n,f,i,a){var r=e+o+n,s=t(window).outerWidth()-n-o;return r>t(window).outerWidth()&&(e=s),s<=f.left&&(e=f.left,a.width(i-n)),e},position:function(e){var o=20,n=e.offset();if("undefined"!=typeof n){var f=e.outerHeight(),a=e.outerWidth(),r=e.attr("name"),s=t('[data-bf-tooltip-id="'+r+'"]'),c=s.outerWidth(),l=s.outerHeight(),d=e.attr("data-bf-tooltip");if(void 0===d){var d=e.parents("form").attr("data-bf-tooltip");void 0===d&&(d="right center")}if("top right"==d){var p=n.left+a/6*5;p=i.response(p,c,o,n,a,s),s.offset({top:n.top-l,left:p})}else if("top center"==d){var p=n.left+a/2;p=i.response(p,c,o,n,a,s),s.offset({top:n.top-l,left:p})}else if("top"==d){var p=n.left;p=i.response(p,c,o,n,a,s),s.offset({top:n.top-l,left:p})}else if("top left"==d){var p=n.left-a/6*5;s.offset({top:n.top-l,left:p})}else if("left center"==d){var p=n.left-c;s.offset({top:n.top+f/2-l/2,left:p})}else if("bottom"==d){var p=n.left;p=i.response(p,c,o,n,a,s),s.offset({top:n.top+f,left:p})}else if("bottom left"==d){var p=n.left-a/6*5;s.offset({top:n.top+f,left:p})}else if("bottom center"==d){var p=n.left+a/2;p=i.response(p,c,o,n,a,s),s.offset({top:n.top+f,left:p})}else if("bottom right"==d){var p=n.left+a/6*5;p=i.response(p,c,o,n,a,s),s.offset({top:n.top+f,left:p})}else if("right center"==d){var p=n.left+a;s.offset({top:n.top+f/2-l/2,left:p})}}}},a={server:function(e,o,n){var f,r,s=0;return i.reset(),o.mail_to?(i.init(t(":focus",e),o.mail_to),!1):(t.each(o,function(n,l){f="","token"==n?c.set_attr_form(e,o.token,"bf-token"):(f=a.set_err_msg(l),r=t('[name="'+n+'"]',e),i.init(r,f),f.length>0&&(s=1))}),!(parseInt(s)>0))},set_err_msg:function(e){var o="";return e.required?o=e.required:e.rangelength?o=e.rangelength:e.minlength?o=e.minlength:e.maxlength?o=e.maxlength:t.each(e,function(t,e){return"required"!=t&&"rangelength"!=t&&"minlength"!=t&&"maxlength"!=t?(o=e,!1):void 0}),o}},r={init:function(e,o,n,f){t.ajax({url:e,data:o,method:"post",dataType:"html",beforeSend:function(t){r.loader_on()},success:function(e){r.set_overlay(),r.set_close_event(),t(".bf-modal, .bf-fixed-overlay").css("opacity","0"),t(".bf-modal-box").html(e),r.loader_off(),t(".bf-modal, .bf-fixed-overlay").animate({opacity:"1"},400),n(f)}})},set_overlay:function(){t(".bf-fixed-overlay").remove(),t("body").append('<div class="bf-fixed-overlay bf-fixed-overlay__modal">                             <div class="bf-modal">                                 <div class="bf-modal_container">                                     <a href="javascript:;" data-bf-popup="close" class="bf-modal-close" title=""></a>                                       <div class="bf-modal-box"></div>                                 </div>                             </div>                         </div>')},loader_on:function(){t("body").append('<div class="bf-loading"></div>')},loader_off:function(){t(".bf-loading").remove()},set_close_event:function(){t(document).on("click","[data-bf-popup='close'], .bf-fixed-overlay",function(){r.close()}),t(document).on("click",".bf-modal",function(t){t.stopImmediatePropagation()})},close:function(){t(".bf-fixed-overlay").remove(),c.init_form()}},s={init:function(){s.update(),t(document).on("click","img[data-bf-capcha]",function(){s.update()})},update:function(){t("img[data-bf-capcha]").attr("src",c.path+"?type=capcha&u="+Math.random())}},c={config:"",path:"/"+e+"/init.php",timer:function(t){var e=2e3,o=t.data("bf-timer");return"undefined"!=typeof o&&parseInt(o)>0&&(e=o),console.log(e),e},init:function(){c.init_form(),c.init_popup_form()},init_popup_form:function(){t(document).on("click","[data-bf-config]:not(form)",function(e){e.preventDefault();var o=t(this).data("bf-config");("undefined"==typeof o||o.length<1)&&(o="");var n=c.get_custom_popup_attributes(t(this));r.init(c.path,{"bf-config":o,attributes:n,type:"form"},c.init_form,{config_popup:o,attributes:n})})},get_custom_popup_attributes:function(e){var o={},n="";return e.length&&t.each(e[0].attributes,function(t,e){n=e.name,/data\-bf\-field/.test(n)&&(n=n.replace("data-bf-",""),o[n]=e.value)}),o.field_page_h1=t("h1").html(),o.field_page_link=document.location.href,o},init_form:function(e){s.init(),f.init(),i.reset(),t(document).off("submit","form[data-bf-config], .bf-modal form").on("submit","form[data-bf-config], .bf-modal form",function(o){o.preventDefault();var n=t(this);"undefined"==typeof e&&(e={},e.config_popup=""),c.config=c.get_config(e.config_popup,n.data("bf-config"));var f=n.formToArray();t.each(f,function(t,e){"file"==e.type&&(f[t].value=e.value.name)}),t.post(c.path,{fields:f,type:"validation","bf-config":c.config},function(f){c.set_attr_form(n,c.config,"bf-config"),a.server(n,f,o)&&("undefined"!=typeof e.attributes&&t.each(e.attributes,function(t,e){c.set_attr_form(n,e,t)}),n.ajaxSubmit({beforeSubmit:function(e,o,n){t(":focus",o).prop("disabled",!0)},success:c.show_response,url:c.path,type:"post",dataType:"json"})),t(".bf-attr").remove()})})},set_attr_form:function(t,e,o){t.prepend('<input name="'+o+'" class="bf-attr" type="hidden" value="'+e+'" />')},get_config:function(t,e){return"undefined"==typeof t||t.length<1?("undefined"==typeof e||e.length<1)&&(e=""):e=t,e},show_response:function(e,o,n,f){t(":focus",f).prop("disabled",!1),e.status>0?(f.hide(),t.ajax({url:c.path,data:{type:"form_success","bf-config":e["bf-config"]},method:"post",dataType:"html",beforeSend:function(t){},success:function(e){f.after(e),setTimeout(function(){r.close()},c.timer(f)),setTimeout(function(){f.show(),f.clearForm(),t("[data-bf-success]").remove()},c.timer(f)+1e3)}})):i.init(t(":focus",f),e.value)},set_success_template:function(){}};c.init()});